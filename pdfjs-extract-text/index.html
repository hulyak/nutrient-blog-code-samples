<!DOCTYPE html>
<html>
    <head>
        <title>PDF.js Text Extraction Test</title>
    </head>

    <body>
        <h1>PDF.js Text Extraction</h1>
        <p>Open the browser console to see the extracted text.</p>
        <div id="output"></div>

        <!-- Load the pdf.js library as a module -->
        <script type="module">
            import * as pdfjsLib from 'https://mozilla.github.io/pdf.js/build/pdf.mjs';

            pdfjsLib.GlobalWorkerOptions.workerSrc =
                'https://mozilla.github.io/pdf.js/build/pdf.worker.mjs';

            function extractText(pdfUrl) {
                var pdf = pdfjsLib.getDocument(pdfUrl);
                return pdf.promise.then(function (pdf) {
                    var totalPageCount = pdf.numPages;
                    var countPromises = [];
                    for (
                        var currentPage = 1;
                        currentPage <= totalPageCount;
                        currentPage++
                    ) {
                        var page = pdf.getPage(currentPage);
                        countPromises.push(
                            page.then(function (page) {
                                var textContent = page.getTextContent();
                                return textContent.then(function (text) {
                                    return text.items
                                        .map(function (s) {
                                            return s.str;
                                        })
                                        .join('');
                                });
                            }),
                        );
                    }

                    return Promise.all(countPromises).then(function (texts) {
                        return texts.join('');
                    });
                });
            }

            const url =
                'https://raw.githubusercontent.com/mozilla/pdf.js/ba2edeae/web/compressed.tracemonkey-pldi-09.pdf';

            extractText(url).then(
                function (text) {
                    console.log('parse ' + text);
                    // Also display a preview on the page
                    document.getElementById('output').innerHTML =
                        '<h2>Extracted Text (first 2000 chars):</h2><pre>' +
                        text.substring(0, 2000) + '...</pre>';
                },
                function (reason) {
                    console.error(reason);
                    document.getElementById('output').innerHTML =
                        '<p style="color: red;">Error: ' + reason + '</p>';
                },
            );
        </script>
    </body>
</html>
